<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Publicidad - MapsX</title>
  <style>
    body,html{
      margin:0;
      height:100%;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .hero{
      width:100%;
      max-width:400px; /* ancho m√°ximo opcional */
      aspect-ratio:9/16; /* formato vertical */
      background:#000;
      position:relative;
    }
    #videoHolder{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      background:#000;
    }
  </style>
</head>
<body>
  <!-- Contenedor del video -->
  <div class="hero">
    <div id="videoHolder" data-video-id="EFe4-ab1lBo"></div>
  </div>

  <script>
    /* --------------------------
       CONFIG
       -------------------------- */
    const VIDEO_ID = document.querySelector('#videoHolder')?.dataset?.videoId || 'EFe4-ab1lBo';
    const REDIRECT_URL = 'https://mapsx.app/publicidad';
    const FALLBACK_REDIRECT_AFTER = 25; // segundos de fallback si la API falla
    let player = null;
    let progressInterval = null;
    let fallbackTimer = null;

    /* utility */
    function redirectNow(){
      window.location.href = REDIRECT_URL;
    }

    /* --------------------------
       LOAD YOUTUBE IFRAME API
       -------------------------- */
    function loadYouTubeApi(){
      return new Promise((resolve)=>{
        if(window.YT && window.YT.Player){
          resolve();
          return;
        }
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        tag.async = true;
        document.head.appendChild(tag);
        // callback requerido por la API
        window.onYouTubeIframeAPIReady = function(){
          resolve();
        };
        // fallback si tarda demasiado
        setTimeout(()=>resolve(), 5000);
      });
    }

    async function initPlayer(){
      await loadYouTubeApi();
      try{
        player = new YT.Player('videoHolder', {
          height: '100%',
          width: '100%',
          videoId: VIDEO_ID,
          playerVars: {
            autoplay: 1,
            controls: 0,
            mute: 1,
            rel: 0,
            playsinline: 1,
            modestbranding: 1,
            disablekb: 1,
            iv_load_policy: 3
          },
          events: {
            onReady: onPlayerReady,
            onStateChange: onPlayerStateChange,
            onError: onPlayerError
          }
        });
      }catch(e){
        console.warn('YT init error', e);
        startFallback();
      }

      // fallback si no arranca
      fallbackTimer = setTimeout(()=>{
        if(!player) startFallback();
      }, (FALLBACK_REDIRECT_AFTER * 1000));
    }

    function onPlayerReady(ev){
      clearTimeout(fallbackTimer);
      try{
        const iframe = ev.target.getIframe();
        if(iframe) iframe.style.pointerEvents = 'none'; // no dejar pausar ni tocar
      }catch(e){}
      try{ ev.target.playVideo(); }catch(e){}
    }

    function onPlayerStateChange(e){
      // 0 = ENDED
      if(e.data === YT.PlayerState.ENDED){
        redirectNow();
      }
      if(e.data === YT.PlayerState.PLAYING){
        clearTimeout(fallbackTimer);
      }
    }

    function onPlayerError(err){
      console.warn('YT player error', err);
      setTimeout(()=>{ redirectNow(); }, 3000);
    }

    function startFallback(){
      setTimeout(()=>{ redirectNow(); }, 5000);
    }

    // limpiar intervalos
    window.addEventListener('beforeunload', ()=>{
      if(progressInterval) clearInterval(progressInterval);
      if(fallbackTimer) clearTimeout(fallbackTimer);
    });

    /* INIT */
    initPlayer();
  </script>
</body>
</html>
